
/**
 * Created with jing.zhao2013
 * Date: 13-11-28
 * Time: 上午10:40
 *    {
 *      cls: "",           //自定义的class样式
 *      closeCls:"",       //关闭按钮的鼠标滑class样式
 *      open:true,         //是否为打开状态
 *      isModal:false,     //是否模态窗口
 *      isDrag:false      //是否可拖动
 *    }
 */
var hexcase = 0;
var chrsz   = 8;
function hex_md5(s){
	return binl2hex(core_md5(str2binl(s), s.length * chrsz));
}
function core_md5(x, len) {
	x[len >> 5] |= 0x80 << ((len) % 32);
	x[(((len + 64) >>> 9) << 4) + 14] = len;

	var a =  1732584193;
	var b = -271733879;
	var c = -1732584194;
	var d =  271733878;

	for(var i = 0; i < x.length; i += 16) {
		var olda = a;
		var oldb = b;
		var oldc = c;
		var oldd = d;

		a = md5_ff(a, b, c, d, x[i+ 0], 7 , -680876936);
		d = md5_ff(d, a, b, c, x[i+ 1], 12, -389564586);
		c = md5_ff(c, d, a, b, x[i+ 2], 17,  606105819);
		b = md5_ff(b, c, d, a, x[i+ 3], 22, -1044525330);
		a = md5_ff(a, b, c, d, x[i+ 4], 7 , -176418897);
		d = md5_ff(d, a, b, c, x[i+ 5], 12,  1200080426);
		c = md5_ff(c, d, a, b, x[i+ 6], 17, -1473231341);
		b = md5_ff(b, c, d, a, x[i+ 7], 22, -45705983);
		a = md5_ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);
		d = md5_ff(d, a, b, c, x[i+ 9], 12, -1958414417);
		c = md5_ff(c, d, a, b, x[i+10], 17, -42063);
		b = md5_ff(b, c, d, a, x[i+11], 22, -1990404162);
		a = md5_ff(a, b, c, d, x[i+12], 7 ,  1804603682);
		d = md5_ff(d, a, b, c, x[i+13], 12, -40341101);
		c = md5_ff(c, d, a, b, x[i+14], 17, -1502002290);
		b = md5_ff(b, c, d, a, x[i+15], 22,  1236535329);

		a = md5_gg(a, b, c, d, x[i+ 1], 5 , -165796510);
		d = md5_gg(d, a, b, c, x[i+ 6], 9 , -1069501632);
		c = md5_gg(c, d, a, b, x[i+11], 14,  643717713);
		b = md5_gg(b, c, d, a, x[i+ 0], 20, -373897302);
		a = md5_gg(a, b, c, d, x[i+ 5], 5 , -701558691);
		d = md5_gg(d, a, b, c, x[i+10], 9 ,  38016083);
		c = md5_gg(c, d, a, b, x[i+15], 14, -660478335);
		b = md5_gg(b, c, d, a, x[i+ 4], 20, -405537848);
		a = md5_gg(a, b, c, d, x[i+ 9], 5 ,  568446438);
		d = md5_gg(d, a, b, c, x[i+14], 9 , -1019803690);
		c = md5_gg(c, d, a, b, x[i+ 3], 14, -187363961);
		b = md5_gg(b, c, d, a, x[i+ 8], 20,  1163531501);
		a = md5_gg(a, b, c, d, x[i+13], 5 , -1444681467);
		d = md5_gg(d, a, b, c, x[i+ 2], 9 , -51403784);
		c = md5_gg(c, d, a, b, x[i+ 7], 14,  1735328473);
		b = md5_gg(b, c, d, a, x[i+12], 20, -1926607734);

		a = md5_hh(a, b, c, d, x[i+ 5], 4 , -378558);
		d = md5_hh(d, a, b, c, x[i+ 8], 11, -2022574463);
		c = md5_hh(c, d, a, b, x[i+11], 16,  1839030562);
		b = md5_hh(b, c, d, a, x[i+14], 23, -35309556);
		a = md5_hh(a, b, c, d, x[i+ 1], 4 , -1530992060);
		d = md5_hh(d, a, b, c, x[i+ 4], 11,  1272893353);
		c = md5_hh(c, d, a, b, x[i+ 7], 16, -155497632);
		b = md5_hh(b, c, d, a, x[i+10], 23, -1094730640);
		a = md5_hh(a, b, c, d, x[i+13], 4 ,  681279174);
		d = md5_hh(d, a, b, c, x[i+ 0], 11, -358537222);
		c = md5_hh(c, d, a, b, x[i+ 3], 16, -722521979);
		b = md5_hh(b, c, d, a, x[i+ 6], 23,  76029189);
		a = md5_hh(a, b, c, d, x[i+ 9], 4 , -640364487);
		d = md5_hh(d, a, b, c, x[i+12], 11, -421815835);
		c = md5_hh(c, d, a, b, x[i+15], 16,  530742520);
		b = md5_hh(b, c, d, a, x[i+ 2], 23, -995338651);

		a = md5_ii(a, b, c, d, x[i+ 0], 6 , -198630844);
		d = md5_ii(d, a, b, c, x[i+ 7], 10,  1126891415);
		c = md5_ii(c, d, a, b, x[i+14], 15, -1416354905);
		b = md5_ii(b, c, d, a, x[i+ 5], 21, -57434055);
		a = md5_ii(a, b, c, d, x[i+12], 6 ,  1700485571);
		d = md5_ii(d, a, b, c, x[i+ 3], 10, -1894986606);
		c = md5_ii(c, d, a, b, x[i+10], 15, -1051523);
		b = md5_ii(b, c, d, a, x[i+ 1], 21, -2054922799);
		a = md5_ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);
		d = md5_ii(d, a, b, c, x[i+15], 10, -30611744);
		c = md5_ii(c, d, a, b, x[i+ 6], 15, -1560198380);
		b = md5_ii(b, c, d, a, x[i+13], 21,  1309151649);
		a = md5_ii(a, b, c, d, x[i+ 4], 6 , -145523070);
		d = md5_ii(d, a, b, c, x[i+11], 10, -1120210379);
		c = md5_ii(c, d, a, b, x[i+ 2], 15,  718787259);
		b = md5_ii(b, c, d, a, x[i+ 9], 21, -343485551);

		a = safe_add(a, olda);
		b = safe_add(b, oldb);
		c = safe_add(c, oldc);
		d = safe_add(d, oldd);
	}
	return Array(a, b, c, d);
}
function md5_cmn(q, a, b, x, s, t) {
	return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b);
}
function md5_ff(a, b, c, d, x, s, t) {
	return md5_cmn((b & c) | ((~b) & d), a, b, x, s, t);
}
function md5_gg(a, b, c, d, x, s, t) {
	return md5_cmn((b & d) | (c & (~d)), a, b, x, s, t);
}
function md5_hh(a, b, c, d, x, s, t) {
	return md5_cmn(b ^ c ^ d, a, b, x, s, t);
}
function md5_ii(a, b, c, d, x, s, t) {
	return md5_cmn(c ^ (b | (~d)), a, b, x, s, t);
}
function safe_add(x, y) {
	var lsw = (x & 0xFFFF) + (y & 0xFFFF);
	var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
	return (msw << 16) | (lsw & 0xFFFF);
}
function bit_rol(num, cnt) {
	return (num << cnt) | (num >>> (32 - cnt));
}
function str2binl(str) {
	var bin = Array();
	var mask = (1 << chrsz) - 1;
	for(var i = 0; i < str.length * chrsz; i += chrsz) {
		bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (i%32);
	}
	return bin;
}
function binl2hex(binarray) {
	var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
	var str = "";
	for(var i = 0; i < binarray.length * 4; i++) {
		str += hex_tab.charAt((binarray[i>>2] >> ((i%4)*8+4)) & 0xF) + hex_tab.charAt((binarray[i>>2] >> ((i%4)*8  )) & 0xF);
	}
	return str;
}
var pwmd5log = new Array();
function pwmd5() {
	if(!$('#'+arguments[0]) || $('#'+arguments[0]).val() == '') {
		return;
	}
	numargs = arguments.length;
	for(var i = 0; i < numargs; i++) {
		if(!pwmd5log[arguments[i]] || $('#'+arguments[i]).val().length != 32) {
			pwmd5log[arguments[i]] = hex_md5($('#'+arguments[i]).val());
			$('#'+arguments[i]).val(pwmd5log[arguments[i]]);
		}
	}
};
(function($){$.fn.extend({"dialog":function(options){
    var ops = $.extend({
        cls: "",
		id:"dialog0",
		width:500,
		height:280,
		title:"温馨提示",
        closeCls:"dialog-close-button-hover",
        open:true,
        isModal:true,
        isDrag:false,
		noBg:false,
		afterClose:null,
        btn:[]
    },options);
	var $shadow;
	var $win = $(window), $dom, $doc = $(document);
	var iTimerID = null;
	var isIE = $.browser.msie && ($.browser.version=="6.0") && !$.support.style;
    var dialog = {
        render:function(){
			var self = this;
            if(ops.isModal){
                self.showShadow();
            }
			self.initDialog();
            if(!ops.open){
                self.close();
            }
            var $close = $dom.find(".dialog-close-button");
            $close.bind({
                'click':function(e){self.close();e.stopPropagation();},
                'mouseover':function(e){$(this).addClass(ops.closeCls);e.stopPropagation();},
                'mouseout':function(){ $(this).removeClass(ops.closeCls);},
                'mousedown':function(e){e.stopPropagation();}
            });
			$win.bind('resize',function(){
				$dom.css("top", ($win.height()-$dom.height())/2+"px");
				$dom.css("left", ($win.width()-$dom.width())/2+"px");
			});
            if(ops.isDrag){
                self.dragndrop();
            }
        },
		initDialog:function(force){
			$dom = $('#'+ops.id);
			if(!$dom.get(0)) {
				$dom = $('<div id="'+ops.id+'" class="dialog-bdqn font-yahei"><div class="dialog-border"></div><div class="dialog"><div class="dialog-top post"><h2 id="h_title"></h2><a href="javascript:void(0);" class="dialog-close-button f0" title="关闭">关闭</a></div><div class="dialog-body"></div></div></div>');
				$("body").append($dom);
			}
			$dom.find("#h_title").text(ops.title);
			dialog.resize(ops.width, ops.height);
		},
		resize:function(w, h){
			var h1=h-38;
			var noBg = ops.noBg?'none':'';
			$dom.css({'width':w+'px', 'height':h+'px'});
			$dom.find('.dialog-border').css({'width':w+'px', 'height':h+'px'});
			$dom.find('.dialog').css({'width':w+'px', 'height':h+'px'});
			$dom.find('.dialog-body').css({'height':h1+'px', 'background':noBg});
			var top = ($win.height()-$dom.height())/2;
			if(isIE) top += $doc.scrollTop();
			$dom.css({'top':top+'px', 'left':($win.width()-$dom.width())/2+'px'});
			if(isIE) {
				$win.scroll(function(){
					top = ($win.height()-$dom.height())/2 + $doc.scrollTop();
					$dom.css({'top':top+'px'});
				});
			}
		},
		close:function(){
            if(ops.isModal && $shadow){
                $shadow.hide();
            }
			if($dom) {
				$dom.find('.dialog-body').html('');
				$dom.hide();
			}
			if(typeof(ops.afterClose)=='function') {
				ops.afterClose();
			}
			if(!$("#playDialog").get(0)){
				$("body").css("overflowY","auto");
				$("#scrollbar-width").remove();
			}
		},
		show:function(){
			$dom.show();
		},
        showShadow:function(){
			if($('.dialog-shadow').get(0)) {
				$shadow = $('.dialog-shadow');
			} else {
				$shadow = $("<div class='dialog-shadow'></div>");
				$("body").append($shadow);
				$("body").css("overflowY","hideen");
			}
            var h = Math.max($win.innerHeight(),$("body").innerHeight());
            var w = Math.max($win.innerWidth(),$("body").innerWidth());
            $shadow.css({height:h,width:w});
            $shadow.show();
        },
        dragndrop:function(){
            var $title = $dom.find(".dialog-top");
            var startX,startY,startLeft,startTop,dragging = false;
            var maxLeft = $win.innerWidth()-$dom.outerWidth();
            var maxTop = $win.innerHeight()-$dom.outerHeight();
            var fn={
                down:function(e){
                    dragging = true;
                    $title.css('cursor','move');
                    startX = e.pageX;
                    startY = e.pageY;
                    startLeft=$dom.offset().left;
                    startTop=$dom.offset().top;
                    e.stopPropagation();
                },
                drag:function(e){
                    if(!dragging) return;
                    var l = Math.min(startLeft + e.pageX - startX,maxLeft);
                    var t = Math.min(startTop + e.pageY - startY,maxTop);
                    $dom.css({left:Math.max(0,l),top:Math.max(0,t)});
                },
                drop:function(){
                    dragging = false;
                    $title.css('cursor','default');
                }
            };
            $title.bind({
                'mousedown':fn.down,
                'mouseover':fn.drag,
                'mouseup':fn.drop
            });
            $(document).bind({
                'mousemove':fn.drag,
                'mouseup':fn.drop
            });
        },
        btnEvent:function(){
            var btn = ops.btn;
            var l = btn.length;
            for(var i=0;i<l;i++){
                if(btn[i].ele&&btn[i].fn){
                    var b=btn[i].ele;
                    var f = btn[i].fn;
                    b.click(function(e){
                        f();
                        e.stopPropagation();
                    });
                }
            }
        },
        init:function(){
            var self = this;
            this.render();
            if(ops.isDrag){
                $win.resize(function(){
                    self.dragndrop();
                });
            }
            if(ops.btn.length){
                self.btnEvent();
            }
        }
    };
    var handler={
        close:function(sec){
			clearTimeout(iTimerID);
			if(typeof(sec)=='number') {
				iTimerID = setTimeout(function(){
					dialog.close();
				}, sec);
			} else {
				dialog.close();
			}
			if(!$("#playDialog").get(0)){
				$("body").css("overflowY","auto");
				$("#scrollbar-width").remove();
			}
        },
		container:function(){
			return $dom;
		},
		resize:function(w, h){
			dialog.resize(w, h);
		},
		setOps:function(options){
			ops = $.extend(ops,options);
		},
		setAfterClose:function(bolen,price){
			ops = $.extend(ops,{afterClose:function(){
				var getPrice = $(".dialog-get");
				var w = $(window).innerHeight();
				if(!$(".dialog-get").get(0)){
					getPrice = $('<div class="dialog-get"></div>');
					getPrice.css({"top":(w-88)/2+"px"});
					$("body").append(getPrice);
				}
				if(bolen){
					getPrice.html('+'+price+' K币').addClass("dialog-get-K");
				}else{
					getPrice.html('+'+price+' 积分').addClass("dialog-get-jf");
				}
				getPrice.fadeIn().fadeOut(3000,function(){
					getPrice.remove();
					window.location.reload();
				});
			}});
		},
        open:function(param, sec){
			try
			{
				if(iTimerID!=undefined)	clearTimeout(iTimerID);
				//$("body").css("overflowY","hidden");
				//scrollWith();
				dialog.init();
				if(typeof(param)=='string'){
					$dom.find(".dialog-body").html(param);
				} else if(typeof(param)=='function') {
					param($dom.find(".dialog-body"));
				} else {
					return ;
				}
				$dom.show();
				if(typeof(sec)=='number') {
					handler.close(sec);
				}
			} catch (e){
			
			}
        }
    };
    return handler;
}})})(jQuery);

var dialog1 = $().dialog({
			cls: "",
			closeCls:'dialog-close-button-hover',
			open:true,
			isModal:true,
			isDrag:false,
			afterClose:function(){
				$('body').css('overflowY','hidden');
			}
});

/**
 * Created with jing.zhao2013
 * Date: 13-6-26
 * Time: 下午4:11
 */
(function($){$.fn.extend({"sliding":function(options){
    var ops = $.extend({
        width:200,
        speed:100,
        pre:null,
        next:null
    },options);
    var $dom=this;
    if(ops.pre){
        ops.pre.click(function(){
            var $first=$dom.children("li").first();
            if(!$first.is(":animated")){
                $first.animate({"margin-left":-ops.width},ops.speed,function(){
                    $(this).css({"margin-left":0}).appendTo($dom);
                });
            }
        });
    }
    if(ops.next){
        ops.next.click(function(){
            var $last=$dom.children("li").last();
            if(!$last.is(":animated")){
                $last.prependTo($dom);
                $last.css({"margin-left":-ops.width});
                $last.animate({"margin-left":0},ops.speed);
            }
        });
    }
}})})(jQuery);


(function($){$.fn.extend({"carousel":function(options){
    var ops = $.extend({
		current:0,
		index:1,
		pre:"pre",
		next:"next",
		changePic:"changePic"
    },options);

    var $dom=this;
	var current = function(num){
		var index=ops.index;
		var l = ($dom.find("li").first().width()+8)*num*parseInt(index/num);
		$dom.find("ul").css("marginLeft",-l);
	};
	if(ops.current)	current(ops.current);

	var moveDiv=function(){
		var w =$dom.width() - 1;
		var _li = $dom.find("li");
		var _ul=$dom.find("ul");
		var sw = _ul.width((_li.first().width()+8)*_li.length);
		jQuery("#"+ops.next).click(function(){
			var l = parseInt(_ul.css("marginLeft"));
			if(l+_ul.width()-w>0){
				_ul.css("marginLeft",-w+l);
			}
		});
		jQuery("#"+ops.pre).click(function(){
			var l = parseInt(_ul.css("marginLeft"));
			if(l<0){
				_ul.css("marginLeft",l+w);
			}
		});
	};

	moveDiv();

	$dom.find("li").click(function(){
        $("#"+ops.changePic).attr("src",$(this).find("img").attr("link_src"));
    });

}})})(jQuery);

/**
 * @输入密码 判断Caps Lock
 *
 */
function lockEvent() {
	var inputPWD = document.getElementById('UserLoginForm_password');
	var capital = false;
	var capitalTip = {
		elem: document.getElementById('capital'),
		toggle: function(s) {
			var sy = this.elem.style;
			var d = sy.display;
			if(s) {
				sy.display = s;
			} else {
				sy.display = d == 'none' ? '' : 'none';
			}
		}
	}
	var detectCapsLock = function(event) {
		if(capital) {
			return
		};
		var e = event || window.event;
		var keyCode = e.keyCode || e.which; // 按键的keyCode
		var isShift = e.shiftKey || (keyCode == 16) || false; // shift键是否按住
		if(
			((keyCode >= 65 && keyCode <= 90) && !isShift) // Caps Lock 打开，且没有按住shift键
			|| ((keyCode >= 97 && keyCode <= 122) && isShift) // Caps Lock 打开，且按住shift键
		) {
			capitalTip.toggle('block');
			capital = true
		} else {
			capitalTip.toggle('none');
		}
	}
	if(inputPWD) {
		inputPWD.onkeypress = detectCapsLock;
		inputPWD.onkeyup = function(event) {
			var e = event || window.event;
			if(e.keyCode == 20 ) {
				capitalTip.toggle();
				return false;
			}
		}
	}
};


/**
 * 通用JS类
 */
var bdqn = {
    FreeChoice_val : '',  //选择连播
    continues : '',    //继续学习
    Jumplearn : '',    //跳转学习/在线编程/课程播放页小测试
	validated:false,
	regUrl:'http://www.kgc.cn/member/reg-mobile',
	findpwdUrl:'http://www.kgc.cn/member/findpwd-mobile',
	loginUrl:'/ajax/ajaxLogin',
	loginInfo:'/member/getLoginInfo',
	captchaUrl:'/member/captcha/refresh/1',
	invalidNums:3,
	md5Login:true,
	dialog:null,
	isIE6:$.browser.msie && ($.browser.version=="6.0") && !$.support.style,
	isIE7:$.browser.msie && $.browser.version=="7.0",
	isIE8:$.browser.msie && $.browser.version=="8.0",
	initPointMenu:function($dom){
		$dom.find("span").live("mouseover", function(e){
		   var d = $dom.find("ul").css("display");
			if(d=="block"){
				$dom.removeClass("integralMenu-click");
			}else{
				$dom.addClass("integralMenu-click");
			}
		   $dom.find("ul").toggle();
		   e.stopPropagation();
		});
		$dom.find("span").live("mouseout", function(e){
			$dom.find("ul").hide();
			$dom.removeClass("integralMenu-click");
		});
	},
	initSearchMenu:function($dom,event){
		$dom.parent().css("overflow","hidden");
		$dom.find("ul").hide();
		if(event=="click"){
			$dom.find("span").live('click', function(e){
				$(this).next("ul").toggle();
				e.stopPropagation();
			});
			$(document).live('click', function(e){
				$dom.find("span").next("ul").hide();
			});
			$dom.find("a").live('cilck', function(e){
				var t = $(this).html();
				var st = $(this).attr('rel');
				$('#scbar_mod').val(st);
				$dom.find("span").eq(0).html(t);
			});
		}else{
			$dom.find("span").live('mouseover', function(){
				$(this).next("ul").show();
			});
			$dom.children("li").live('mouseleave', function(){
				$(this).find("ul").hide();
			});
		}
		$dom.find("ul li").live('click', function(){
			$("#menu_search").children("li").find("span").text($(this).text());
			$("#scbar_mod").val($(this).find("a").attr("rel"));
		});
	},
	initGroupTip:function($dom){
		var tip = $dom.siblings('.tips');
		//$dom.unbind("hover");
		$dom.live("mouseover", function(e){
			var l = $(this).offset().left;
			var w = tip.width();
			var x = l-w;
			tip.css({"left":x,"position":"absolute"});
			tip.show();
		});
		$dom.live("mouseout",function(){
			tip.hide();
		});
	},
	initSearchContent:function($dom) {
		var defaultText = "请输入搜索内容";
		$dom.live('focus', function(){
				if($(this).val()==defaultText){
					$(this).val("");
				}
			});
		$dom.live('blur', function(){
				if($(this).val()==""){
					$(this).val(defaultText);
				}
		});
		$dom.closest("form").submit(function(){
			if($dom.val()==defaultText || $dom.val()=="") {
				alert(defaultText);
				$dom.focus();
				return false;
			}
		});
	},
	addCollect:function(e) {
		//加入收藏
		e.live('click', function() {
			var ctrl = (navigator.userAgent.toLowerCase()).indexOf('mac') != -1 ? 'Command/Cmd': 'CTRL';
			if (document.all) {
				window.external.addFavorite(location.href, document.title);
			} else if (window.sidebar && window.sidebar.addPanel) {
				window.sidebar.addPanel(document.title, location.href, "");
			} else {
				alert('您可以尝试通过快捷键' + ctrl + ' + D 加入到收藏夹~');
			}
		});
	},
	setHomePage:function(e){
		//设为首页
		e.live('click', function(){
			var url = location.href;
			var browser_name = navigator.userAgent;
			if(browser_name.indexOf('Chrome')!=-1){alert("此操作被浏览器拒绝！\n请在浏览器地址栏输入“chrome://settings/browser”，进行主页设置。")};
			try {
				this.style.behavior = "url(#default#homepage)";
				this.setHomePage(url);
			} catch (e) {
				if (window.netscape) {
					try {
						netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
					} catch (e) {
						alert("此操作被浏览器拒绝！\n请在浏览器地址栏输入“about:config”并回车\n然后将 [signed.applets.codebase_principal_support]的值设置为'true',双击即可。");
						return false;
					}
					var prefs = Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);
					prefs.setCharPref('browser.startup.homepage',url);
				}
			}
			return false;
		});
	},
	getLoginInfo:function(e){
		$.ajax({
			url:bdqn.loginInfo,
			success: function(data) {
				e.html(data);
			}
		});
	},
	changeCaptcha:function(e){
		$.ajax({
			url: bdqn.captchaUrl,
			data: 'refresh=1',
			dataType: 'json',
			cache: false,
			success: function(data) {
				e.attr('src', data['url']);
				$('body').data('captcha.hash', [data['hash1'], data['hash2']]);
			}
		});
		return false;
	},
	login:function(data, callback){
		var hidClass = data.msg<bdqn.invalidNums ? 'hide' : '';
		var fm = '<div class="yui3-g">';
		fm += '<div class="yui3-u-1 loginAjax">';
		fm += '<form id="loginAjaxForm" action="" class="fix">';
		fm += '<ul class="left form_ul">';
        fm += '     <li>';
		fm += '	    <input class="r-icp lg-input" placeholder="手机/邮箱" autocomplete="off" name="KgcForm_models_LoginForm[identity]" id="UserLoginForm_username" type="text" value=""><br/><em></em>';
        fm += '     </li>';
        fm += '      <li class="psw-span">';
		fm += '				<div class="psw-upper" id="capital" style="display:none;"><span class="psw-upperIcon"></span><span class="psw-upperTip">大写已锁定</span></div>';
        fm += '            <input class="r-icp lg-input"  placeholder="密码" autocomplete="off" name="KgcForm_models_LoginForm[password]" id="UserLoginForm_password" type="password"><br/><em></em>';
        fm += '      </li>';
		fm += '		<li class="captcha '+hidClass+'">';
		fm += '		 <input class="r-icp lg-input lg-inputs" maxlength="4" name="KgcForm_models_LoginForm[verifyCode]" id="UserLoginForm_verifyCode" type="text" placeholder="验证码"><img title="看不清楚,换一张" id="captchaImg" src="'+bdqn.captchaUrl+'" alt=""/><br/><em></em>';
        fm += '      </li>';
        fm += '      <li class="buttom">';
		fm += '		 <input class="r-icp pass white f14 submit-button" value="登 录" id="login" type="button" name="yt0">';
		fm += '      <span class="wjmm"><a href="'+bdqn.findpwdUrl+'" target="_blank" title="忘记密码">忘记密码?</a></span>';
        fm += '      </li>';
        fm += '</ul>';
		fm += '<div class="left quick-login-l"><div class="form_div f14">';
		fm += '还没有账号？<br/><a href="'+bdqn.regUrl+'" class="regist_a" target="_blank">免费注册</a></div>';
		fm += '		<div class="other-login">';
		fm += '			<h2><p class="line"></p><i>使用第三方帐号登录</i></h2>';
		fm += '			<div class="other-login-btn">';	
		fm += '				<a href="http://www.kgc.cn/vendors/weixin/login" title="使用微信登录" class="login-wx"></a>';			
		fm += '				<a href="http://www.kgc.cn/vendors/qq/login" title="使用QQ登录" class="login-qq"></a>';		
		fm += '				<a href="http://www.kgc.cn/vendors/weibo/login" title="使用微博登录" class="login-xl"></a>';		
		fm += '			</div>';
		fm += '		</div></div>';
		fm += '	   </form>';
        fm += '  </div>';
        fm += '</div>';
		var h = data.msg<bdqn.invalidNums?310:380;
		bdqn.dialog = $().dialog({width:660,height:h, title:'登录',noBg:true});
		bdqn.dialog.open(fm);
		//调用密码大写函数
		lockEvent();
		if(bdqn.isIE6 || bdqn.isIE7 || bdqn.isIE8) {
			$('#UserLoginForm_username').after('<span class="placeholder">手机/邮箱</span>');
			$('#UserLoginForm_password').after('<span class="placeholder">密码</span>');
			$('#UserLoginForm_verifyCode').after('<span class="placeholder">验证码</span>');
		}
		bdqn.initLoginEvent(callback);
	},
	initLoginEvent:function(callback){
		$('.loginAjax .lg-input').hover(
			function(){$(this).addClass('bd-blue');}, 
			function(){$(this).removeClass('bd-blue');
		});
		$('.loginAjax .submit-button').hover(
			function(){$(this).addClass('login-hover');},
			function(){$(this).removeClass('login-hover');
		});
		$('#UserLoginForm_username').bind({
			blur:function(){bdqn.validated = bdqn.isEmpty($(this), '手机/邮箱不能为空');},
			keyup:function(event){var keycode=event.which; if(keycode==13){bdqn.loginSubmit($('#loginAjaxForm'), callback)}}
		});
		$('#UserLoginForm_password').bind({
			blur:function(){bdqn.validated = bdqn.isEmpty($(this), '密码不能为空') && bdqn.validated;},
			keyup:function(event){var keycode=event.which; if(keycode==13){bdqn.loginSubmit($('#loginAjaxForm'), callback)}}
		});
		if(!$('.captcha').hasClass('hide')) {
			$('#UserLoginForm_verifyCode').bind({
				blur:function(){bdqn.validated = bdqn.isEmpty($(this), '验证码不能为空') && bdqn.validated;},
				keyup:function(event){var keycode=event.which; if(keycode==13){bdqn.loginSubmit($('#loginAjaxForm'), callback)}}
			});
		}
		$('#captchaImg').live('click', function(){
			bdqn.changeCaptcha($(this));
		});
		$('.loginAjax .submit-button').click(function(){
			bdqn.loginSubmit($('#loginAjaxForm'), callback);
		});
	},
	loginSubmit:function(e, callback){
		bdqn.validate();
		if(bdqn.validated) {
			bdqn.doLogin(e, callback);
		}
	},
	isEmpty:function(e, msg){
		e.siblings('em').html('');
		if($.trim(e.val())=='') {
			e.siblings('span').show();
			e.siblings('em').html(msg);
			return false;
		}
		return true;
	},
	validate:function(){
		bdqn.validated = bdqn.isEmpty($('#UserLoginForm_username'), '手机/邮箱不能为空');
		bdqn.validated = bdqn.isEmpty($('#UserLoginForm_password'), '密码不能为空') && bdqn.validated;
		if(!$('.captcha').hasClass('hide')) {
			bdqn.validated = bdqn.isEmpty($('#UserLoginForm_verifyCode'), '验证码不能为空') && bdqn.validated;
		}
	},
	doLogin:function(e, callback){
		if(e.find("#login").hasClass("login-btn-gray"))return;
		if(bdqn.md5Login) {
			$('#UserLoginForm_password').val(hex_md5($('#UserLoginForm_password').val()));
		}
		e.find("#login").addClass("login-btn-gray").val("登录中...");
		var data = e.serialize();
		$.ajax({
			url: bdqn.loginUrl,
			data: data+'&ajax=login-dialog',
			type: 'POST',
			dataType:'json',
			success: function(data) {
				if(data.code==1) {
					bdqn.getLoginInfo($('#loginInfo'));
					if(typeof(callback)=='function') {
						callback();
					}
                    if(data.myurl)$("body").append("<script src= "+ data.myurl +"  type='text/javascript'></script>");
				} else if(data.code==-1) {
					$('#UserLoginForm_password').val('');
					$('#UserLoginForm_username').siblings('em').html('对不起，你的账号还没有激活');
				} else {
					if(data.invalidNums>=bdqn.invalidNums) {
						e.find('.captcha').removeClass('hide');
						bdqn.dialog.resize(660, 380);
					} else {
						e.find('.captcha').addClass('hide');
						bdqn.dialog.resize(660, 310);
					}
					$('#UserLoginForm_password').val('');
					for (var key in data.error) {
						$('#UserLoginForm_'+key).siblings('em').html(data.error[key][0]);
					}
				}
				e.find("#login").removeClass("login-btn-gray").val("登 录");
			}
		});
		return true;
	},
	init:function(){
		bdqn.addCollect($("#addcollect"));
		bdqn.setHomePage($("#sethomepage"));
		bdqn.initSearchMenu($('#menu_search'), "click");
		bdqn.initPointMenu($("#integralMenus"));
		bdqn.initGroupTip($("#show_block"));
		bdqn.initSearchContent($("#searchContent"));
	}
};


/**
 * Created with jing.zhao2013
 * Date: 13-11-28
 * Time: 上午10:40
 *    {
 *      cls: "",           //自定义的class样式
 *      closeCls:"",       //关闭按钮的鼠标滑class样式
 *      open:true,         //是否为打开状态
 *      isModal:false,     //是否模态窗口
 *      isDrag:false      //是否可拖动
 *    }
 */
(function($){$.fn.extend({"yjdialog":function(options){
    var ops = $.extend({
        cls: "",
        closeCls:"",
        open:true,
        isModal:false,
        isDrag:false,
        btn:[]
    },options);
    var $dom = $(this),
        $shadow = $("<div style='-moz-opacity:0.25;opacity:0.25;filter:alpha(opacity=25);position:absolute;border:none;background:#000;top:0;left:0;z-index:9999;display:none;'></div>"),
        $win = $(window);
    if(!$dom.get(0)) return;
    var dialog = {
        render:function(){
            $dom.addClass(ops.cls);
            $dom.css("z-index","10000");
            if(ops.isModal){
                this.showShadow();
            }
            if(!ops.open){
                $dom.hide();
                if(ops.isModal){$shadow.hide();}
            }
            var $close = $dom.find(".dialog-close-button");
            if($close.get(0)){
                $close.bind({
                    'click':function(e){if(ops.isModal){$shadow.hide();}$dom.hide();e.stopPropagation();},
                    'mouseover':function(e){$(this).addClass(ops.closeCls);e.stopPropagation();},
                    'mouseout':function(){ $(this).removeClass(ops.closeCls);},
                    'mousedown':function(e){e.stopPropagation();}
                });
            }
            if(ops.isDrag){
                this.dragndrop();
            }
        },
        showShadow:function(){
            var h = Math.max($win.innerHeight(),$("body").innerHeight());
            var w = Math.max($win.innerWidth(),$("body").innerWidth());
            $shadow.css({height:h,width:w});
            $("body").append($shadow);
        },
        dragndrop:function(){
            var $title = $dom.find(".dialog-top");
            var startX,startY,startLeft,startTop,dragging = false;
            var maxLeft = $win.innerWidth()-$dom.outerWidth();
            var maxTop = $win.innerHeight()-$dom.outerHeight();
            var fn={
                down:function(e){
                    dragging = true;
                    $title.css('cursor','move');
                    startX = e.pageX;
                    startY = e.pageY;
                    startLeft=$dom.offset().left;
                    startTop=$dom.offset().top;
                    e.stopPropagation();
                },
                drag:function(e){
                    if(!dragging) return;
                    var l = Math.min(startLeft + e.pageX - startX,maxLeft);
                    var t = Math.min(startTop + e.pageY - startY,maxTop);
                    $dom.css({left:Math.max(0,l),top:Math.max(0,t)});
                },
                drop:function(){
                    dragging = false;
                    $title.css('cursor','default');
                }
            };
            $title.bind({
                'mousedown':fn.down,
                'mouseover':fn.drag,
                'mouseup':fn.drop
            });
            $(document).bind({
                'mousemove':fn.drag,
                'mouseup':fn.drop
            });
        },
        btnEvent:function(){
            var btn = ops.btn;
            var l = btn.length;
            for(var i=0;i<l;i++){
                if(btn[i].ele&&btn[i].fn){
                    btn[i].ele.click(btn[i].fn);
                }
            }
        },
        init:function(){
            var self = this;
            this.render();
            if(ops.isDrag){
                $win.resize(function(){
                    self.dragndrop();
                });
            }
            if(ops.isModal){
                $win.resize(function(){
                    self.showShadow();
                });
            }
            if(ops.btn.length){
                self.btnEvent();
            }
        }
    };
    var handler={
        close:function(){
            if(ops.isModal){
                $shadow.hide();
            }
            $dom.hide();
        },
        open:function(str){
            if(ops.isModal){
                $shadow.show();
            }
            if(str){
                $dom.find(".dialog-body").html(str)
            }
            $dom.show();
        },
        setPosition:function(style){
            $dom.css(style);
        },
        setShadowPosition:function(style){
            $shadow.css(style);
        }
    };
    dialog.init();
    return handler;
}})})(jQuery);

/**
 * Created with jing.zhao2013
 * Date: 13-5-3
 * Time: 上午11:37
 *                                          为了兼容ie6
 * 参数：
 *    {
 *      isBack:true,      //（可选）是否回顶部功能，默认为true
 *      goBack:false,     //（可选）是否返回上一页，默认为false。goback与isback同时为true时优先实现回顶部
 *      scrollTop:0,      //（可选）滚动条高度多少开始出现
 *      position:"auto",  //（可选）position为位置信息，内容的左边或者右边
 *      width:1000,       //（可选）距离网页内容模块的宽度
 *      offset:5,         //（可选）距离网页内容模块间距
 *      bottom:"auto"     //（可选）距离底部距离
 *    }
 */
(function($){$.fn.extend({"backBtn":function(options){
    var ops=$.extend({
        isBack:true,
        goBack:false,
        scrollTop:0,
        position:"auto",
        width:1000,
        offset:5,
        bottom:"auto",
        speed:100,
        ifshow:true
    }, options);
    var $dom=$(this),$doc=$(document),$win = $(window);
    if(!$dom.get(0)) return;
    var opr={
        getTop:function(){
            var t = $dom.offset().top;
            if(ops.bottom!="auto"){
                t = $win.height()-$dom.height()-ops.bottom;
            }
            return t;
        },
        getLeft:function(){
            var l = $dom.offset().left;
            var w = $dom.outerWidth();
            var ww = $win.width();
            var minw = ops.width+(ops.offset+w)*2;
            if(ops.position=="left"){
                if(ww>minw){
                    l = (ww-ops.width)/2-w-ops.offset;
                }else{
                    l=0;
                }
            }else if(ops.position=="right"){
                if(ww>minw){
                    l = (ww-ops.width)/2+ops.width+ops.offset;
                }else{
                    l=ww-w;
                }
            }
            return l;
        },
        ifShow:function(){
            if($win.scrollTop()>ops.scrollTop){
                $dom.show();
            }else{
                $dom.hide();
            }
        },
        setTop:function(){
            var t = this.getTop();
            var l = this.getLeft();
            if($.browser.msie&&$.browser.version==="6.0"){
                t = $doc.scrollTop()+t;
                if(t>$doc.height()){
                    t=$doc.height()-ops.bottom-$dom.outerWidth();
                }
                $dom.css({position:"absolute",top:t,left:l});
            }else{
                $dom.css("position","fixed");
                if($dom.css("left")!=l+"px"){
                    $dom.css("left",l);
                }
                if($dom.css("top")!=t+"px"){
                    $dom.css("top",t);
                }
            }
        },
        handler:function(){
            if(ops.isBack){
                $dom.live('click', function(){
                    $("body,html").animate({scrollTop:0},ops.speed);
                    if(ops.scrollTop>0){
                        $dom.hide();
                    }
                });
            }else if(ops.goBack){
                $dom.click(function(){
                    history.go(-1);
                });
            }
            var self = this;
            self.setTop();
            if(!ops.ifshow){
                self.ifShow();
            }
            $win.scroll(function(){
                if($.browser.msie&&$.browser.version==="6.0"){
                    self.setTop();
                }
                if(!ops.ifshow){
                    self.ifShow();
                }
            });
            $win.resize(function(){
                self.setTop();
                if(!ops.ifshow){
                    self.ifShow();
                }
            });
        }
    };
    opr.handler();
    return $dom;
}})})(jQuery);

(function($){$.fn.extend({"newSlideBox":function(option){
    var s_height=option.height?option.height:300;//默认高度300
    var s_width=option.width?option.width:500;//默认宽度500
    var s_speed=option.speed?option.speed:1;//默认切换速度1秒
    var s_circle=option.circle;//默认图片不循环
    if(s_circle==undefined){
        s_circle=false;
    }
    var s_pageInfo=option.pageInfo;
    var s_page=s_pageInfo.page;//默认页码显示
    if(s_page==undefined){
        s_page=true;
    }
    var $dom = $(this);
    $dom.css({'height':s_height,'width':s_width});
    $dom.addClass("pv-slideBox");
    $dom.find("li").height(s_height);
    //$dom.find("img").width(s_width);
    var $li=$dom.find("li");
    $dom.closest(".h-slide-box").css("background-color", "#"+$li.eq(0).attr("data-background"));
    var len = $li.length;
    if(len<=1) return;
    var index=0;
    var stop=true;
    if(s_page){
        var page=["<ul class='pv-slideBox-page'>"];
        var pageImg=s_pageInfo.pageImg;
        if(pageImg){
            var s_pageImgDom=s_pageInfo.pageImgDom;
            var s_imgs = s_pageImgDom.find("li");
            for(var i=0;i<len;i++){
                var s_img =s_imgs[i];
                if(s_img){
                    page.push('<li class="imgli">' +$(s_img).html()+'</li>');
                }else{
                    page.push('<li class="imgli">' +(i+1)+'</li>');
                }
            }
        }else{
            var s_pageContents=s_pageInfo.pageContent;
            for(var i=0;i<len;i++){
                if(s_pageContents&&s_pageContents[i]){
                    var s_pageContent=s_pageContents[i];
                    page.push('<li>' +s_pageContent+'</li>');
                }else{
                    page.push('<li>' +(i+1)+'</li>');
                }
            }
        }
        page.push("</ul>");
        $dom.append(page.join(""));
        //效果
        $(".pv-slideBox-page li").eq(index).addClass("pv-slideBox-current-page").stop(true,true).fadeTo(400,1).siblings()
            .removeClass("pv-slideBox-current-page").fadeTo(400,1);
        $(".pv-slideBox-page").on("mouseover","li",function(){
            stop=false;
            index=$(".pv-slideBox-page li").index($(this));
            $dom.closest(".h-slide-box").css("background-color", "#"+$li.eq(index).attr("data-background"));
            $li.eq(index).stop(true,true).fadeIn().siblings().hide();
            $(this).addClass("pv-slideBox-current-page").stop(true,true).fadeTo(400,1).siblings()
                .removeClass("pv-slideBox-current-page").fadeTo(400,1);
        });
        $(".pv-slideBox-page").on("mouseout","li",function(){
            stop=true;
        });
    }
    //循环
    if(s_circle){
        setInterval(function(){
            if(!stop) return;
            index++;
            if(index>=len){
                index=0;
            }
            $dom.closest(".h-slide-box").css("background-color", "#"+$li.eq(index).attr("data-background"));
            $li.eq(index).stop(true,true).fadeIn().siblings().hide();
            $(".pv-slideBox-page li").eq(index).addClass("pv-slideBox-current-page").stop(true,true).fadeTo(400,1).siblings()
                .removeClass("pv-slideBox-current-page").fadeTo(400,1);
        },s_speed*1000);
    }
}})})(jQuery);

/**
 * Created by zhaojing.
 * Date: 13-2-22
 *  参数：
 *    {
 *      width:500,            //（可选）宽度，默认500
 *      height:300,           //（可选）高度，默认300
 *      page:true,            //（可选）是否有下标，默认true
 *      pageContent:[],       //（可选）下标内容
 *      circle:false,         //（可选）默认为false，是否自动轮换
 *      speed:1               //（可选）自动轮换速度
 *    }
 */

(function($){$.fn.extend({"slideBox":function(options){
    var ops=$.extend({
        width:500,
        height:300,
        page:true,
        pageContent:[],
        circle:false,
        speed:1
    }, options);
    var $dom = $(this);
    if(!$dom.get(0)) return;
    var $content=$dom.find(".slideBox-content");
    if(!$content.get(0)) return;
    var $page=$dom.find(".slideBox-page");
    var index= 0,stop=true;
    var opr = {
        render:function(){
            $dom.css({'width':ops.width,'height':ops.height});
            $dom.addClass("pv-slideBox");
            $content.find("li").css({'width':ops.width,'height':ops.height});
            $content.find("img").width(ops.width);
        },
        showPage:function(){
            var page=["<ul class='pv-slideBox-page'>"];
            var $li=$content.find("li");
            var len = $li.length;
			for(var i=0;i<len;i++){
				 page.push('<li><span></span></li>');
			}
            page.push("</ul>");
            $dom.append(page.join(""));
            var $myPage = $dom.find(".pv-slideBox-page");
            var $myPageLi = $myPage.find("li");
            $myPageLi.eq(index).addClass("pv-slideBox-current-page").siblings().removeClass("pv-slideBox-current-page");
            $myPage.on("mouseover","li",function(){
                stop=false;
                index=$myPageLi.index($(this));
                $li.eq(index).stop(true,true).fadeIn().siblings().fadeOut();
                $(this).addClass("pv-slideBox-current-page").siblings().removeClass("pv-slideBox-current-page");
            });
            $myPage.on("mouseout","li",function(){
                stop=true;
            });
        },
        autoCircle:function(){
            var $li=$content.find("li");
            var len = $li.length;
            var $myPage = $dom.find(".pv-slideBox-page");
            setInterval(function(){
                if(!stop) return;
                index++;
                if(index>=len){
                    index=0;
                }
                $li.eq(index).stop(true,true).fadeIn().siblings().fadeOut();
                if(ops.page){
                    $myPage.find("li").eq(index).addClass("pv-slideBox-current-page").siblings().removeClass("pv-slideBox-current-page");
                }
            },ops.speed*1000);
        },
        init:function(){
            this.render();
            if(ops.page){
                this.showPage();
            }
            if(ops.circle){
                this.autoCircle();
            }
        }
    };
    opr.init();
    return $dom;
}})})(jQuery);

var megSelf1;
/**头像悬浮出个人信息**/
var txInfo = {
	top:null,
	sameId:null,
	sameInfo:null,
	model:null,
	init:function(url){
		txInfo.top = 0;
                megSelf1 = url;
		$(window).scroll(function(){
			txInfo.top = $(this).scrollTop();
		});
		txInfo.event();
	},
	event:function(){
		var txTime = null;
		$(".list-uc-w").live("mouseover",function(){
			if(txTime) clearTimeout(txTime);
			var self = $(this);
			
			var homeUrl = $(this).find("a").attr("href");
			var imgUrl = $(this).find("a img").attr("src");
			var uid = parseInt(homeUrl.replace(/[^\d]+/i, ""));
			var bz = self.hasClass("banzhu-msg");
			if(bz){
				imgUrl = $(this).find("input[type='hidden']").attr("data");
			}
			var info='';
			if(!$("#show-uc-info").get(0)){
				var param='';
				param+='<div class="show-uc-info hide" id="show-uc-info">';
				param+='</div>';
				$("body").append(param);
			}
			if(txInfo.sameId != uid){
				if($(this).hasClass("onMouse")) return;
				$("#show-uc-info").html('<div class="show-uc-box fix"><p><img src="/img/tx-loading.gif"/></p></div>');
				$(this).addClass("onMouse");
				$.get("/member/card",{uid:uid},function(data){
					txInfo.sameId = uid;
					if(data.code==1){
						info+=	'<div class="show-uc-box rela fix">';
						info+=		'<p class="show-uc-l left"><i class="rela" style="display:block;"><img src="'+imgUrl+'"/>';
                        if(data.user.isStudent){
                            info+=		'<span title="学员" class="gl-bg"><img src="'+data.user.imgurl+'"></span>';
                        }
                        if(data.user.isTeacher){
                            info+=		'<span title="老师" class="gl-bg"><img src="'+data.user.imgurl+'"></span>';
                        }
						if(bz || data.user.isMaster){
							info+=		'<span title="版主" class="gl-bg"><img src="'+data.user.imgurl+'"></span>';
						}
						if(data.user.isManager){
							info+=		'<span title="管理员" class="gl-bg"><img src="'+data.user.imgurl+'"></span>';
						}


						info+=		'</i>';
                        if (data.selfuid!=0 && data.selfuid != uid && data.user.selfIsManager) {
                            if(data.user.user_banned){
                                info+='<a class="no-talk talk-bg talk-dialog" href="javascript:void(0);" data-id="'+uid+'" >禁言</a>';
                            }else{
                                info+='<span class="no-talk">已禁言</span>';
                            }
                        }
						info+=		'</p>';
						info+=		'<div class="show-uc-r left">';
                        if(typeof(data.user.nickname)!="undefined"){
                            info+=			'<span>'+data.user.nickname+'</span>';
                        }
                        if(typeof(data.user.field1)!="undefined"){
                            info+=			'<span>'+data.user.field1+'</span>';
                        }
						info+=			'<p><a href="'+data.user.basic+'" title="积分等级：'+data.user.k_grade+'" target="_blank">  '+data.user.k_medal+'</a></p>';
						info+=			'<div class="ucenter-btn">';
						if (data.selfuid != uid) {
							if (data.user.user_care) {
								info += '<a href="javascript:void(0);" class="center-gz cancel-usercare" data="' + uid + '" >取消关注</a>';
							} else {
								info += '<a href="javascript:void(0);" class="center-gz set-usercare" data="' + uid + '" >+加关注</a>';
							}
                            if(typeof(data.user.nickname)!="undefined"){
                                info+=			'<a href="'+megSelf1+'?id='+data.user.nickname+'" class="mp-save" target="_blank">私信</a>';
                            }
                            if(typeof(data.user.field1)!="undefined"){
                                info+=			'<a href="'+megSelf1+'?id='+data.user.field1+'" class="mp-save" target="_blank">私信</a>';
                            }
						}
						info+=		'<a href="'+homeUrl+'" class="go-his-uc">TA的主页</a></div></div>';
						info+=	'</div>';
						info+=	'<div class="show-uc-btm">';
						info+=		'<span><label>'+data.user.k_credits+'</label><br/>积分</span>';
						info+=		'<span class="border"><label>'+data.user.k_answers+'</label><br/>问答</span>';
						info+=		'<span><label>'+data.user.k_goodnums+'</label><br/>被赞</span>';
						info+=	'</div>';
						$("#show-uc-info").html(info);
						self.removeClass("onMouse");
						//txInfo.sameInfo='<div class="show-uc-info hide">'+info+'</div>';
					}else{
						$("#show-uc-info").html('<p>'+data.msg+'</p>');
						self.removeClass("onMouse");
					}
				},'json');
			}
			//$(".show-uc-info").hide();
			$("#show-uc-info").show();
			//调用悬浮info框在上还是下
			var thisTop = $(this).offset().top;
			var thisL = $(this).offset().left;
			$("#show-uc-info").css("left",thisL-80+"px");
			if((thisTop-txInfo.top)<190){
				if(bz){
					$("#show-uc-info").css("top",thisTop+23+"px");
				}else{
					$("#show-uc-info").css("top",thisTop+47+"px");
				}
			}else{
				$("#show-uc-info").css("top",thisTop-180+"px");
			}
		});
		$(".list-uc-w").live("mouseout",function(){
			var self = $(this);
			txTime = setTimeout(function(){
				$("#show-uc-info").hide();
			},100);
		});
		$("#show-uc-info").live("mouseover",function(){
			if(txTime) clearTimeout(txTime);
			$(this).show();
		});
		$("#show-uc-info").live("mouseout",function(){
			txTime = setTimeout(function(){
				$("#show-uc-info").hide();
			},100);
		});

		/**是否禁言**/
		$("#talk-btn").live("click",function(){
            var self = $(this);
            var ba_uid = self.attr("data-id");
			var parent = self.parent().prev(".manage-con");
            var fid = parent.find(".forum-group").val();
            var result = parent.find("#talkResult").val();
            $.post("/portal/setBanned",{fid:fid,result:result,ba_uid:ba_uid},function(data) {
                if (data.code == 1) {
                   txInfo.model.close();
					$("a.no-talk[data-id="+ba_uid+"]").before('<span class="no-talk">已禁言</span>');
					$("a.no-talk[data-id="+ba_uid+"]").remove();
				   //window.location.reload();
                }else{
                    parent.find(".error").html(data.msg);
                }
            },'json');

		});
		/***禁言按钮***/
		$(".talk-dialog").live("click",function(){
            var ba_uid = $(this).attr("data-id");
			txInfo.dialog(ba_uid);
		});
		$(".talk-quit").live("click",function(){
			txInfo.model.close();
		});
	},
	dialog:function(ba_uid){
		var handle = txInfo.model = $().dialog({
			id:'manage-dialog',
			width:350,
			height:350
		});
		var param = '';
		param += '<div class="manage-box">';
		param +=	'<div class="manage-con">';
		param +=		'<p><label>禁言时间：</label>';
		param +=			'<span><select class="forum-group">';
		param +=				'<option value="1">1天</option><option value="2">2天</option><option value="3">3天</option><option value="4">4天</option><option value="5">5天</option><option value="6">6天</option><option value="7">7天</option><option value="8">永久</option>';
		param +=			'</select></span>';
		param +=		'</p>';
		param +=		'<p class="talk-area"><label>禁言理由：</label><textarea id="talkResult" name="talkResult"></textarea>';
        param +=        '<p class="error"></p>';
		param +=	'</div>';
		param +=	'<div class="btm-all">';
		param +=		'<a href="javascript:void(0);" class="detail-sure" id="talk-btn" data-id="'+ba_uid+'">确定</a>';
		param +=		'<a href="javascript:void(0);" class="detail-quit talk-quit">取消</a>';
		param +=	'</div>';
		param += '</div>';
		handle.open(param);
		$("#h_title").text("禁言管理");
	},
	position:function(top){
		$(".list-uc-w").each(function(){
			var thisTop = $(this).offset().top;
			if((thisTop-top)<190){
				$(this).find(".show-uc-info").css("top","47px");
			}else{
				$(this).find(".show-uc-info").css("top","-180px");
			}
		});
	}
};
//文本编辑器 去除html
function removeHTMLTag(str) {
	str = str.replace(/<\/?[^>]+>/g, '');
    str = str.replace(/\&[a-z]+;/gi, '');
	str = str.replace(/[ | ]*\n/g,'\n'); //去除行尾空白
	str=str.replace(/&nbsp;/ig,'');//去掉&nbsp;
	return str;
}

/**积分弹框**/
function getDialogInvit(price){
	var getPrice = $(".dialog-get");
	var w = $(window).innerHeight();
	if(!$(".dialog-get").get(0)){
		getPrice = $('<div class="dialog-get dialog-get-K"></div>');
		getPrice.css({"top":(w-88)/2+"px"});
		$("body").append(getPrice);
	}
	if(price != 0){
		getPrice.html('+'+price+' K币');
		getPrice.fadeIn().fadeOut(3000);
	}
}


$(function(){
	bdqn.init();
	$(window).resize(function(){
		bdqn.initGroupTip($("#show_block"));
	});
	$('#loginAjaxForm').find('span').live('click', function(){
		if(!$(this).hasClass('left') && !$(this).hasClass('wjmm')) $(this).hide();
		$(this).siblings('input').focus();
	});

	$('#loginAjaxForm').find('input').live('click', function(){
		$(this).siblings('.placeholder').hide();
	});

	$('#loginAjaxForm').find('input').live('focus', function(){
		$(this).siblings('.placeholder').hide();
	});

	//头部头像悬浮&&消息
	var touxiangTime = null;
	$('.top-hover').find('a').live('mouseover', function(){
		if(touxiangTime) clearTimeout(touxiangTime);
		$('.touxiang_hover').hide();
		$(this).siblings('.touxiang_hover').show();
	});

	$('.top-hover').find('a').live('mouseout', function(){
		var _this = $(this);
		touxiangTime = setTimeout(function(){
			_this.siblings('.touxiang_hover').hide();
		},300);
	});

	$('.touxiang_hover').live('mouseover', function(){
		if(touxiangTime) clearTimeout(touxiangTime);
		$(this).show();
	});
	$('.touxiang_hover').live('mouseout', function(){
		$(this).hide();
	});
	/*头部导航固定
	$(window).scroll(function(){
		$(".fix_header .header").css("top",$(this).scrollTop());
	});*/
	//头部导航 学院悬浮 显示二级导航
	var navTime = null;
	$(".menu .top-nav-school").on({
		mouseover:function(){
			if(navTime) clearTimeout(navTime);
			$(".top-nav-ej").hide();
			$(this).next(".top-nav-ej").show();
			$(".menu .top-nav-school").removeClass("school-current");
			$(this).addClass("school-current");
		},
		mouseout:function(){
			navTime = setTimeout(function(){
				$(".top-nav-ej").hide();
			},100);
			$(this).removeClass("school-current");
		}
	});
	$(".top-nav-ej").on({
		mouseover:function(){
			if(navTime) clearTimeout(navTime);
			$(this).show();
			$(this).prev().addClass("school-current");
		},
		mouseout:function(){
			//$(".menu .top-nav-school").mouseout();
			$(this).hide();
			$(this).prev().removeClass("school-current");
		}
	});

	//列表头像悬浮
    var megSelf = privateUrl+"/my/private/add";
    txInfo.init(megSelf);

	//头部签到框
	$(".header-qd-close").live('click', function(){
		$.post("/user/usercheckclose",function(json){},'json');
		$(".header-qd").hide();
	});
	$(".header-qd-href").live('click', function(){
		$(this).parent().hide();
	});

	/*"邀请好友"右侧悬浮
	$("#index-invite span").hover(function(){
		$(this).stop().animate({top:"-6px"}, 200).animate({top:"0"}, 200).animate({top:"-3px"}, 100).animate({top:"0"}, 100).animate({top:"-2px"}, 100).animate({top:"0"}, 100);
	},function(){
		$(this).stop();
	});
	//  邀请码
	$("#invite-code").backBtn({
		isBack:false,
		goBack:false,
		position:"right",
		width:1140,
		offset:10,
		bottom:305
	});
	//  邀请好友
	$("#index-invite").backBtn({
		isBack:false,
		goBack:false,
		position:"right",
		width:1140,
		offset:10,
		bottom:255
	});
	//  回到顶部
	$("#backTop").backBtn({
		isBack:true,
		goBack:false,
		scrollTop:0,
		position:"right",
		width:1140,
		offset:10,
		bottom:30,
		ifshow:false,
		speed:300
	});
	$("#feedback").backBtn({
		isBack:false,
		goBack:false,
		position:"right",
		width:1140,
		offset:10,
		bottom:90
	});
	//APP 下载
	$("#downApp").backBtn({
		isBack:false,
		goBack:false,
		position:"right",
		width:1140,
		offset:10,
		bottom:150
	});
	//QQ
	$("#QQ").backBtn({
		isBack:false,
		goBack:false,
		position:"right",
		width:1140,
		offset:10,
		bottom:210
	});*/
	$(window).scroll(function(){
		var top = $(this).scrollTop();
		if(top>100){
			$("#backTop").show();
		}else{
			$("#backTop").hide();
		}
	});
	$("#backTop").click(function(){
		$("html,body").animate({"scrollTop":0},300);
	});
	// 反馈弹出窗
	function dialogFeedback(){
		var _form = $("#dialogFeedback_form");
		var $tel = _form.find("#tel");
		var $message=_form.find("#message");
		$tel.focus(function(){
			if($(this).val()==""||$(this).val()=="邮箱/手机/QQ号（可选）"){
				$(this).val("").addClass("on");
			}
		}).blur(function(){
			if($(this).val()==""){
				$(this).val("邮箱/手机/QQ号（可选）").removeClass("on");
			}
		});
		$message.focus(function(){
			if($(this).val()==""||$(this).val()=="您的积极反馈是我们前进的动力"){
				$(this).val("").addClass("on");
			}
		}).blur(function(){
			if($(this).val()==""){
				$(this).val("您的积极反馈是我们前进的动力").removeClass("on");
			}
		});
		var validate=function(){
			var message=$.trim($message.val());
			var tel=$.trim($tel.val());
			if(message==""||message=="您的积极反馈是我们前进的动力"){
				alert("留言不能为空！");
				return false;
			}else if(tel.length>50){
				alert("联系方式不能超过50个字符！");
				return false;
			}else if(message.length>600){
				alert("留言不能超过600个字符！");
				return false;
			}else{
				return "message="+message+"&tel="+tel;
			}
		};
		var ow=$("#dialogFeedback").outerWidth();
		var oh=$("#dialogFeedback").outerHeight();
		var w=($(window).width()-ow)/2;
		var t=($(window).height()-oh)/2;
		var dialogFeedbackSuccess = $("#dialogFeedback_success").yjdialog({
			closeCls:'dialog-close-button-hover',
			open:false,
			isModal:true
		});
		var dialogFeedback = $("#dialogFeedback").yjdialog({
			closeCls:'dialog-close-button-hover',
			open:false,
			isModal:true,
			btn:[{ele:$("#feedbackBtn"),fn:function(){
				var params=validate();
				if(!params) return false;
				$.ajax({
					type: "POST",
					url:"/portal/leaveMessage.shtml",
					data: params,
					success: function(){
						dialogFeedback.close();
						$tel.val("邮箱/手机/QQ号（可选）").removeClass("on");
						$message.val("您的积极反馈是我们前进的动力").removeClass("on");
						dialogFeedbackSuccess.open();
						dialogFeedbackSuccess.setPosition({top:$(window).scrollTop()+t,left:w})
					},
					error:function (XMLHttpRequest, textStatus, errorThrown) {
						alert(XMLHttpRequest+"___"+textStatus+"___"+errorThrown);
						return false;
					}
				});
				return false;
			}}]
		});
		$("#feedback").live('click', function(){
			dialogFeedback.open();
			dialogFeedback.setShadowPosition({height:Math.max($("window").innerHeight(),$("body").innerHeight())});
			dialogFeedback.setPosition({top:$(window).scrollTop()+t,left:w});
		});
		$(window).scroll(function(){
			dialogFeedback.setPosition({top:$(window).scrollTop()+t});
			dialogFeedbackSuccess.setPosition({top:$(window).scrollTop()+t});
		});
		$(window).resize(function(){
			var rew=($(window).width()-ow)/2;
			var ret=($(window).height()-oh)/2;
			dialogFeedback.setPosition({top:$(window).scrollTop()+ret,left:rew});
			dialogFeedbackSuccess.setPosition({top:$(window).scrollTop()+ret,left:rew});
		});
	}
	//dialogFeedback();

	/**点击邀请码关闭按钮**/
	$("#invite-code").on("click","span",function(){
		$(this).parent().hide();
	});
	/**点击邀请码**/
	$("#invite-code").on("click","a",function(){
		var param = '';
		param += '<div class="invitCode">';
		param +=	'<div class="tipInfo">请输入邀请码</div>';
		param +=	'<div class="codeInput"><input type="text" id="codeNum"/></div>';
		param +=	'<div class="codeError"></div>';
		param +=	'<div class="codeSubmit"><a href="javascript:void(0);">提交</a></div>';
		param +=	'<div class="codeBtm">课工场邀请码是课工场VIP学员、社区版主等拥有的邀请特权。新用户输入邀请码可直接免费领取K币。</div>';
		param += '</div>';
		dialog1.open(param);
		$("#h_title").html("邀请码领K币");
	});
	/**邀请码提交**/
	$("#codeNum").live("focus",function(){
		var box = $(this).closest(".invitCode");
		var error = box.find(".codeError");
		error.html("");
	});
	$(".codeSubmit a").live("click",function(){
		if($(this).hasClass("click")) return;
		$(this).addClass("click");
		var box = $(this).closest(".invitCode");
		var error = box.find(".codeError");
		var val = box.find("#codeNum").val();
		var slef = $(this);
		if($.trim(val)==""){
			error.html("邀请码不能为空");
			slef.removeClass("click");
			return;
		}
		slef.addClass("disable").html("提交中...");
        $.post("/portal/webcredit",{'codeNum':val},function(data){
            if(data.code==1){
                $('.invite-code').html('');
                $('.dialog-shadow').hide();
                $("body").css("overflowY","auto");
                $('.dialog').hide();
				getDialogInvit(data.integral);
                //window.location.reload();
            }else{
                error.html(data.msg);
            }
            slef.removeClass("click disable").html("提交");
        },'json');
	});
	//点击底部微信
	$("#wxbg").click(function(e){
		$(".wx_abso").toggle();
		e.stopPropagation();
	});
	$(document).click(function(){
		$(".wx_abso").hide();
	});

	/**收藏板块&&板块列表**/
	$(".common-discuz li").hover(
		function(){
			$(this).addClass("common-discuz-current");
		},
		function(){
			$(this).removeClass("common-discuz-current");
		}
	);

	

	/*
	*** 头部搜索
	*/
	//课程，帖子切换
	$(".nav-search-con").click(function(){
		if($(this).hasClass("nav-search-on")){
			$(this).next().hide();
			$(this).removeClass("nav-search-on");
		}else{
			$(this).next().show();
			$(this).addClass("nav-search-on");
		}
	});
	if($(".nav-search-con").text() == "帖子"){
            $('#search_type').val('thread');
	}else if($(".nav-search-con").text() == "用户"){
            $('#search_type').val('user');
        }else{
            $('#search_type').val('course');
	}
	$(".nav-slide a").click(function(){
		var old = $(".nav-search-con").text();
		var newT = $(this).text();
		$(".nav-search-con").text(newT);
		$(this).text(old);
		$(".nav-search-input").attr("placeholder","请输入关键词");
		if(newT == "帖子"){
            $('#search_type').val('thread');
		}else if(newT == "用户"){
			$(".nav-search-input").attr("placeholder","请输入昵称");
			$('#search_type').val('user');
		}else{
			$('#search_type').val('course');
		}
		$(this).parent().hide();
		$(this).parent().prev().removeClass("nav-search-on");
	});
	$(document).click(function(e){
		if(!$(e.target).closest(".nav-search-l").get(0)){
			$(".nav-search-con").next().hide();
			$(".nav-search-con").removeClass("nav-search-on");
		}
	});
	//搜索按钮
	$("#nav-search").click(function(){
		var val = $(".nav-search-input").val();
		var parent = $(this).closest(".nav-search-box");
		if($.trim(val)==""){
			parent.addClass("search-error");
			return;
		} else {
			var search_type = 'course';
			if($(".nav-search-con").text()=='帖子') {
				search_type = 'thread';
			}else if($(".nav-search-con").text()=='用户') {
				search_type = 'user';
			}
			$('#search_type').val(search_type);
			$(this).closest('form').submit();
		}
	});
	$(".nav-search-input").focus(function(){
		var parent = $(this).closest(".nav-search-box");
		parent.removeClass("search-error");
		parent.addClass("searching-on");
	});
	$(".nav-search-input").blur(function(){
		var parent = $(this).closest(".nav-search-box");
		parent.removeClass("searching-on");
	});
	$(".nav-search-input").keyup(function(){
		if($.trim($(this).val())==""){
			$(this).removeClass("nav-input-on");
		}else{
			$(this).addClass("nav-input-on");
		}
	});
	$(".nav-search-box form[name='search']").submit(function(e){
		var val = $(this).find(".nav-search-input").val();
		if($.trim(val)==""){
			$(".nav-search-box").addClass("search-error");
			e.preventDefault();
		}
	});

    /**悬浮头像添加关注**/
    $(".set-usercare").live('click',function(){
        if($(this).hasClass("onClick")) return;
        var self = $(this);
        $fk_uid = self.attr("data");
        $(this).addClass("onClick");
        $.post("/my/social/setcare", {fk_uid:$fk_uid}, function (result) {
            if (result['code'] == 1) {
                if(bdqn.dialog) bdqn.dialog.close();
                self.removeClass("set-usercare  onClick");
                self.addClass("cancel-usercare");
                self.text("取消关注");
              //新手任务首次关注用户弹框
              if(result['task'] == 1){
                setTimeout(function(){awardReceive.init(result['username']);},1000);
              }
            } else if(result['code'] == -2) {//用户为登陆
                bdqn.login(result, function(result){
                    self.removeClass("onClick");
                    self.click();
                });
                bdqn.dialog.setOps({afterClose:function(){
                    self.removeClass("onClick");
                }});
            }else if(result['code'] == -3) {//用户已关注过该用户
                dialog1.open("<p>"+result['msg']+"</p>",3000);
                self.removeClass("set-usercare  onClick");
                self.addClass("cancel-usercare");
                self.text("取消关注");
            }else if(result['code'] == -4) {//关注自己
                //dialog1.open("<p>"+result['msg']+"</p>",3000);
                if(bdqn.dialog) bdqn.dialog.close();
                self.hide();
            }else{//错误提示
                dialog1.open("<p>"+result['msg']+"</p>",3000);
             }
        }, 'json');
    });
	//取消关注悬浮
	// $(".cancel-usercare").live({
	// 	mouseover:function(){
	// 		$(this).text("取消关注");
	// 	},
	// 	mouseout:function(){
	// 		$(this).text("已关注");
	// 	}
	// });
    /**悬浮头像取消关注**/
    $(".cancel-usercare").live('click',function(){
        if($(this).hasClass("onClick")) return;
        var self = $(this);
        $fk_uid = self.attr("data");
        $(this).addClass("onClick");
        $.post("/my/social/cancelcare", {fk_uid:$fk_uid}, function (result) {
            if (result['code'] == 1) {
                self.removeClass("cancel-usercare onClick");
                self.addClass("set-usercare");
                self.text("+加关注");
            } else {
                dialog1.open("<p>"+result['msg']+"</p>",3000);
            }
        }, 'json');
    });

	/**
	 * @右侧qq群
	 */
	qqGroup.init();

	// 我的钱包提示
	$(".myhelp").hover(function(){
		$(this).append('<div class="myhelp-hover"><div class="myhelpcon"></div><p class="f16">零钱可通过推广好友注册获得，能够充值K币哟，将来还能直接提现为现金呐。</p></div>');
	},function(){
		$(this).empty();
	})
	
});
/**
 * @右侧qq群
 */
var qqGroup = {
	time:null,
	init:function(){
		$(".qq-box").hover(function(){
			if(qqGroup.time) clearTimeout(qqGroup.time);
			$(this).find(".qq-list").stop(true,true).animate({"right":0},250);
			$(".move-left").stop(true,true).animate({"right":"236px"},250);
		},function(){
			var self = $(this);
			qqGroup.time = setTimeout(function(){
				self.find(".qq-list").stop(true,true).animate({"right":"-236px"},250);
				$(".move-left").stop(true,true).animate({"right":0},250);
			},300);
		});
		this.listSize();
		$(window).resize(function(){
			qqGroup.listSize();
		});
	},
	listSize:function(){
		var screen = $(window).height();
		var h = screen-92;
		var h1 = h-58;
		$(".qq-list").height(h);
		$(".qq-list .qq-list-main").height(h1);
	}
};


//回复帖子等等 跳转相应
function target(){
	var targetId = location.href.split("?")[1];
	try{//添加try避免jquery选择器错误问题，导致后续程序无法执行
		if(targetId && $("#"+targetId).get(0)){
			var top = $("#"+targetId).offset().top-100;
			$("html,body").animate({"scrollTop":top+"px"},500)
		}
	}catch(e){}

}

//用户行为统计 js
function onload_url(url){
    if(ifcountopen!==false){
        var hm = document.createElement("script");
        hm.src = url;
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    }
}

//tab切换区分
function target1(tab,obj,classname){
    var href = window.location.href;
    var hrefId = href.split("#")[1];
    if(hrefId){
        obj.find("a").removeClass(classname);
        obj.find("a[param="+hrefId+"]").addClass(classname);
        tab.children().hide();
        tab.children("."+hrefId).show();
    }
}
var endRegister = {
  endDialog:null,
  init:function(){
    this.endDialog = $().dialog({
      title:"",
      width:470,
      height:486
    });
    var param = "";
    param += '<div class="newsGuide">';
    param += '<div class="guidContent">欢迎来到课工场，在这里你将学到最IN最实用的互联网技术，不论你是前端还是后端，安卓还是苹果开发，UI设计抑或运营推广，都能找到一群志同道合的小伙伴，一起学习，共同成长。<br/>课工场的课程大部分需要K币才能观看，新手任务是一种获得K币的快捷有效的方式哦，快快点击新手任务，开始你的课工场之旅吧~~</div>';
    param += '<div></div><a href="javascript:void(0);" class="stayHere">留在当前页面</a><a href="/my/task.shtml" class="doTask">查看任务</a></button>';
    param += '</div>';
    this.endDialog.open(param);
    $(".dialog").css("background","rgba(0,0,0,0)");
    $(".dialog .dialog-top").css("background","rgba(0,0,0,0)");
    $(".dialog-close-button").text("×").removeClass("f0").css({"z-index":100000,"background":"#fff","top":0,"right":"25px","font-size":"30px","color":"#ccc"});
    this.event()
  },
  event:function(){
    $(".stayHere").live('click',function(){
      endRegister.endDialog.close();
    })
  }
};

var awardReceive = {
  endDialog: null,
  init: function (user) {
    this.endDialog = $().dialog({
      title: '',
      width: 480,
      height: 184
    });
    var param = "";
    param +=    '<div class="awardReceive"><p>亲爱的'+user+'，恭喜您完成了新任务，快去任务中心领取奖励吧。</p><a href="/my/task.shtml" class="lqBtn">领取奖励</a></div>';
    this.endDialog.open(param);
    $(".dialog0").css({"border-radius":"10px","padding":"8px"});
    $(".dialog").css({"border-radius":"10px","padding":"8px"});
    $(".dialog-body").css("height","146px");
    $(".dialog .dialog-top").remove();
    this.event()
  },
  event: function () {
    $(".dialog-shadow").live('click', function () {
      awardReceive.endDialog.close();
    })
  }
};